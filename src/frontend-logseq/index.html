<!doctype html>
<html>

<head>
    <!-- <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet"> -->

    <link rel="stylesheet" href="../resources/css/env-development.css">

</head>

<body>

    <script>
        const html = `
            <div class="overlay-container light" x-data="{ 
    endpointUrl: 'https://serene.tail0b4c1.ts.net/icon-search/',
    query: '',
    top_k: 16, 
    results: [],
    log_open: false,
    log_text: [],
    Assist: 'lol',
    loading: false,
    
    fetchResults() {
        this.loading = ! this.loading;
        this.logMessage('Fetching results...');
        const url = this.endpointUrl + encodeURIComponent(this.query) + '?top_k=' + this.top_k;
        this.logMessage('Endpoint url: ' + url);
    
        fetch(url)
        .then(response => response.json())
        .then(data => {
            this.loading = ! this.loading;
            this.results = data.result;

            this.logMessage('Data recieved successfully.');
            this.logMessage(JSON.stringify(data.result, null, 2));
            this.logMessage('Results rendered.');
        })
        .catch(error => {
            this.loading = ! this.loading;
            
            this.logMessage('Error fetching results.');
            this.logMessage('Content origin: ' + window.location.origin);
            console.log('Content origin: ' + window.location.origin);
        });
      },
    
      logMessage(content) {
        this.log_text.push(content);
        this.$nextTick(() => {
            const logContainer = this.$refs.logContainer;
            logContainer.scrollTop = logContainer.scrollHeight;
          });
      },
    }">

            <div class="options-container"> <!-- position: fixed -->
                <span class="menu-container"> <!-- position: relative -->
                    <md-filled-tonal-icon-button aria-label="open settings" id="menu-button">
                        <md-icon>&#xeaeb;</md-icon>
                    </md-filled-tonal-icon-button>
                    <md-menu id="main-menu" anchor="menu-button">
                        <md-menu-item>
                            <div slot="headline" id="menu-option-settings">Settings</div>
                        </md-menu-item>
                        <md-menu-item>
                            <div slot="headline" id="menu-option-messages">Messages</div>
                        </md-menu-item>
                    </md-menu>
            </div>

            <div class="top-container">

                <!-- Title text -->
                <div class="title-container" id="titleContainer">
                    <h1 id="title" class="md-typescale-display-medium">Icon search</h1>
                </div>

                <!-- Search input -->
                <div class="search-container" id="searchField">
                    <form>
                        <md-outlined-text-field label="Icon name" type="search" required x-model="query">
                            <md-icon slot="leading-icon">&#xeb1c;</md-icon>
                        </md-outlined-text-field>

                    </form>
                </div>

                <!-- Progress indicator -->
                <md-linear-progress indeterminate x-show="loading"></md-linear-progress>
            </div>

            <!-- Action button -->
            <div class="fab-container">
                <md-fab size="large" variant="primary" type="submit" aria-label="Search" x-on:click="fetchResults()">
                    <md-icon slot="icon">&#xeb1c;</md-icon>
                </md-fab>
            </div>

            <!-- Settings dialog -->
            <md-dialog id="dialog-settings">
                <div slot="headline">
                    Settings
                </div>
                <form slot="content" id="form-settings" method="dialog">
                    <label>Results returned
                        <md-slider labeled min="16" max="120" value="40"
                            x-model.number.debounce.500ms="top_k"></md-slider>
                    </label>
                </form>
                <div slot="actions">
                    <md-text-button form="form-settings">Ok</md-text-button>
                </div>
            </md-dialog>

            <!-- Messages dialog -->
            <md-dialog id="dialog-messages">
                <span slot="headline">
                    <span style="flex: 1;">Debug messages</span>
                    <md-icon-button form="form-messages" value="close" aria-label="Close dialog">
                        <md-icon>&#xeb55;</md-icon>
                    </md-icon-button>
                </span>
                <form slot="content" class="log" id="form-messages" method="dialog" x-ref="logContainer"
                    x-text="log_text.join('\\n')">
                </form>
            </md-dialog>

            <!-- Search results  -->
            <div class="content-container">
                <md-list>
                    <template x-for="icon in results" x-bind:key="icon.name">
                        <md-list-item type="button" x-on:click="navigator.clipboard.writeText(icon.glyph)">
                            <div slot="headline" x-text="icon.name"></div>
                            <div slot="supporting-text" x-text="icon.keywords"></div>
                            <md-icon slot="start" x-html="'&#x' + icon.glyph + ';'" class="search-result"></md-icon>
                        </md-list-item>
                        <md-divider role="separator"></md-divider>
                    </template>
                </md-list>
            </div>
        </div>
            `;

        var overlay = document.createElement('div');
        overlay.className = 'icon-search-overlay';
        overlay.innerHTML = html;
        document.body.appendChild(overlay);
    </script>


    <!-- <script defer src="../resources/js/main.js"></script> -->
    <script defer src="../../dist/alpine.min.3.14.0.js"></script>
    <script type="module" src="../../dist/material-design-3.js"></script>
    <script type="module" src="../resources/js/type-styles.js"></script>
    
</body>

</html>