<md-dialog id="icon-search-main-dialog" class="icon-search" x-data="{
        // Settings
        endpointUrl: 'https://serene.tail0b4c1.ts.net/icon-search/',
        top_k: 16, 
        // Search
        query: '',
        results: [],
        // State
        loading: false,
        log_text: [],

        fetchResults() {
            this.loading = ! this.loading;
            const url = this.endpointUrl + encodeURIComponent(this.query) + '?top_k=' + this.top_k;
            this.logMessage('Fetching results...');
            this.logMessage('Endpoint url: ' + url);
        
            fetch(url)
            .then(response => response.json())
            .then(data => {
                this.results = data.result;
                this.loading = ! this.loading;
                $refs.iconSearchQuery.blur(); // hide keyboard
                this.logMessage('Data recieved');
            })
            .catch(error => {
                this.loading = ! this.loading;
                this.logMessage('Error fetching results.\n\nContent origin: ' + window.location.origin);
                console.log('Content origin: ' + window.location.origin);
            });
          },

          logMessage(content) {
            this.log_text.push(content);
            this.$nextTick(() => {
                const logContainer = this.$refs.logContainer;
                //logContainer.scrollTop = logContainer.scrollHeight;
              });
          },
        }">

    <header slot="headline" class="icon-search">
        <md-tabs id="icon-search-primary-tabs" aria-label="Content to view" class="icon-search">
            <md-primary-tab id="icon-search-icons-tab" aria-controls="icon-search-icons-panel">
                Icon search
            </md-primary-tab>
            <md-primary-tab id="icon-search-settings-tab" aria-controls="icon-search-settings-panel">
                Settings
            </md-primary-tab>
        </md-tabs>

        <md-linear-progress indeterminate x-show="loading"></md-linear-progress>

    </header>

    <main slot="content" id="icon-search-icons-panel" role="tabpanel" aria-labelledby="icons-tab" class="icon-search horizontally-fill">
        <section class="center-content">
            <form id="icon-search-form" method="dialog">
                <md-outlined-text-field id="icon-search-query"
                x-ref="iconSearchQuery" label="Icon name"
                autofocus required 
                x-on:focus="$refs.iconSearchQuery.select()"
                x-on:keyup.enter="fetchResults"
                 x-model="query">
                    <md-icon-button x-ref="searchQueryButton" slot="trailing-icon" x-on:click.prevent="fetchResults">
                        <md-icon>&#xeb1c;</md-icon>
                    </md-icon-button>
                </md-outlined-text-field>
            </form>
        </section>

        <md-list id="icon-search-results-container" class="grid-3col hidden-scrollbar">
            <template x-for="icon in results" x-bind:key="icon.name">
                <md-list-item type="button"
                    x-on:click="navigator.clipboard.writeText(icon.glyph); hideIconSearchDialog()"
                    class="center-content top-align-content">

                    <md-icon slot="headline" x-html="'&#x' + icon.glyph + ';'" class="block center-self large" style="margin-bottom: 1rem;"></md-icon>

                    <span slot="supporting-text" x-html="icon.name.replace(/-./g, function(match) {
                        return match.length === 2 ? ' ' + match[1] : '<br>';
                      })"></span>
                      <!-- Replace hyphens with linebreaks, unless the next word is a single letter, in which case replace with a space. https://sl.bing.net/boC9kFkW5KK -->

                </md-list-item>
                <md-divider role="separator"></md-divider>
            </template>
        </md-list>

        <!-- <md-list id="icon-search-results-container" class="icon-search icon-grid">
            <template x-for="icon in results" x-bind:key="icon.name">
                <md-list-item type="button"
                    x-on:click="navigator.clipboard.writeText(icon.glyph); hideIconSearchDialog"
                    class="icon-item">
                    <div slot="headline" x-text="icon.name"></div>
                    <div slot="supporting-text" x-text="icon.keywords"></div>
                    <md-icon slot="start" x-html="'&#x' + icon.glyph + ';'" class="search-result"></md-icon>
                </md-list-item>
                <md-divider role="separator"></md-divider>
            </template>
        </md-list> -->

    </main>

    <main id="icon-search-settings-panel" slot="content" role="tabpanel" aria-labelledby="icon-search-settings-tab"
        hidden>
         <div class="icon-search-settings-row">
            <figure class="icon-search-settings-icon-column">
                <md-icon>&#xf3f3;</md-icon>
            </figure>
            <div class="icon-search-settings-content-column">
                <label for="result_quantity">Search results</label>
                <md-slider id="result_quantity" min="20" max="200" value="40" step="10" x-model.number.debounce.500ms="top_k" labeled></md-slider>
            </div>
        </div>
    </main>
</md-dialog>